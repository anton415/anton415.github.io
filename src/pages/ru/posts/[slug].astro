---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { buildSlugMapById } from '../../../i18n/alternatePaths';

export async function getStaticPaths() {
  const posts = await getCollection('postsRu');
  const postsEn = await getCollection('posts');
  const postSlugMap = buildSlugMapById(posts, postsEn);

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: {
      post,
      switchToEnPath: `/posts/${postSlugMap.get(post.slug) ?? post.slug}`,
    },
  }));
}

const { post, switchToEnPath } = Astro.props;
const { Content } = await post.render();

const formattedDate = post.data.date.toLocaleDateString('ru-RU', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const metaParts = [post.data.tags.join(', ')];
if (post.data.readingTime) {
  metaParts.push(post.data.readingTime);
}
const metaLine = metaParts.join(' Â· ');
---

<BaseLayout
  title={post.data.title}
  description={post.data.description}
  image={post.data.socialImage}
  ogType="article"
  locale="ru"
  switchToEnPath={switchToEnPath}
>
  <article class="card post">
    <p class="pill">{formattedDate}</p>
    <p class="meta">{metaLine}</p>
    <h1>{post.data.title}</h1>
    <p class="lede">{post.data.description}</p>
    <Content />
  </article>
</BaseLayout>

<style>
  .post h1 {
    margin-top: 0.7rem;
  }

  .lede {
    font-size: 1.1rem;
    color: #4d4235;
  }

  .meta {
    margin: 0.75rem 0 0;
    font-size: 0.85rem;
    color: #5a5041;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .post :global(p) {
    line-height: 1.7;
  }
</style>
